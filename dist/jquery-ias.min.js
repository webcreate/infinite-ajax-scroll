/*!
 * Infinite Ajax Scroll, a jQuery plugin
 * Version 1.0.2
 * https://github.com/webcreate/infinite-ajax-scroll
 *
 * Copyright (c) 2011-2013 Jeroen Fiege
 * Licensed under MIT:
 * https://raw.github.com/webcreate/infinite-ajax-scroll/master/MIT-LICENSE.txt
 */
(function(a){Date.now=Date.now||function(){return +new Date()};a.ias=function(d){var m=a.extend({},a.ias.defaults,d);var c=new a.ias.util();var i=new a.ias.paging(m.scrollContainer);var h=(m.history?new a.ias.history():false);var f=this;function q(){var x;i.onChangePage(function(A,y,z){if(h){h.setPage(A,z)}m.onPageChange.call(this,A,z,y)});t();if(h&&h.havePage()){p();x=h.getPage();c.forceScrollTop(function(){var y;if(x>1){l(x);y=s(true);a("html, body").scrollTop(y)}else{t()}})}return f}q();function t(){n();m.scrollContainer.scroll(g)}function g(){var y,x;y=c.getCurrentScrollOffset(m.scrollContainer);x=s();if(y>=x){if(r()>=m.triggerPageThreshold){p();j(function(){u(y)})}else{u(y)}}}function p(){m.scrollContainer.unbind("scroll",g)}function n(){a(m.pagination).hide()}function s(y){var z,x;z=a(m.container).find(m.item).last();if(z.size()===0){return 0}x=z.offset().top+z.height();if(!y){x+=m.thresholdMargin}return x}function u(z,y){var x;x=a(m.next).attr("href");if(x=="#noneleft"){if(m.noneleft){a(m.container).find(m.item).last().after(m.noneleft)}return p()}if(m.beforePageChange&&a.isFunction(m.beforePageChange)){if(m.beforePageChange(z,x)===false){return}}i.pushPages(z,x);p();o();e(x,function(D,C){var A=m.onLoadItems.call(this,C),B;if(A!==false){a(C).hide();B=a(m.container).find(m.item).last();B.after(C);a(C).fadeIn()}x=a(m.next,D).attr("href");if(x==undefined||x=="#"){x="#noneleft"}a(m.next).attr("href",x);k();n();if(x){t()}else{p()}m.onRenderComplete.call(this,C);if(y){y.call(this)}})}function e(B,C,A){var z=[],x,E=Date.now(),D,y;A=A||m.loaderDelay;a.get(B,null,function(F){x=a(m.container,F).eq(0);if(0===x.length){x=a(F).filter(m.container).eq(0)}if(x){x.find(m.item).each(function(){z.push(this)})}if(C){y=this;D=Date.now()-E;if(D<A){setTimeout(function(){C.call(y,F,z)},A-D)}else{C.call(y,F,z)}}},"html")}function l(x){var y=s(true);if(y>0){u(y,function(){p();if((i.getCurPageNum(y)+1)<x){l(x);a("html,body").animate({scrollTop:y},400,"swing")}else{a("html,body").animate({scrollTop:y},1000,"swing");t()}})}}function r(){var x=c.getCurrentScrollOffset(m.scrollContainer);return i.getCurPageNum(x)}function w(){var x=a(".ias_loader");if(x.size()===0){x=a('<div class="ias_loader">'+m.loader+"</div>");x.hide()}return x}function o(){var x=w(),y;if(m.customLoaderProc!==false){m.customLoaderProc(x)}else{y=a(m.container).find(m.item).last();y.after(x);x.fadeIn()}}function k(){var x=w();x.remove()}function v(y){var x=a(".ias_trigger");if(x.size()===0){x=a('<div class="ias_trigger"><a href="#">'+m.trigger+"</a></div>");x.hide()}a("a",x).off("click").on("click",function(){b();y.call();return false});return x}function j(z){var x=v(z),y;y=a(m.container).find(m.item).last();y.after(x);x.fadeIn()}function b(){var x=v();x.remove()}};a.ias.defaults={container:"#container",scrollContainer:a(window),item:".item",pagination:"#pagination",next:".next",noneleft:false,loader:'<img src="images/loader.gif"/>',loaderDelay:600,triggerPageThreshold:3,trigger:"Load more items",thresholdMargin:0,history:true,onPageChange:function(){},beforePageChange:function(){},onLoadItems:function(){},onRenderComplete:function(){},customLoaderProc:false};a.ias.util=function(){var c=false;var e=false;var b=this;function d(){a(window).load(function(){c=true})}d();this.forceScrollTop=function(f){a("html,body").scrollTop(0);if(!e){if(!c){setTimeout(function(){b.forceScrollTop(f)},1)}else{f.call();e=true}}};this.getCurrentScrollOffset=function(g){var f,h;if(g.get(0)===window){f=g.scrollTop()}else{f=g.offset().top}h=g.height();return f+h}};a.ias.paging=function(){var e=[[0,document.location.toString()]];var h=function(){};var d=1;var b=new a.ias.util();function i(){a(window).scroll(g)}i();function g(){var l,n,m,k,j;l=b.getCurrentScrollOffset(a(window));n=c(l);m=f(l);if(d!==n){k=m[0];j=m[1];h.call({},n,k,j)}d=n}function c(j){for(var k=(e.length-1);k>0;k--){if(j>e[k][0]){return k+1}}return 1}this.getCurPageNum=function(j){j=j||b.getCurrentScrollOffset(a(window));return c(j)};function f(j){for(var k=(e.length-1);k>=0;k--){if(j>e[k][0]){return e[k]}}return null}this.onChangePage=function(j){h=j};this.pushPages=function(j,k){e.push([j,k])}};a.ias.history=function(){var c=false;var b=false;function d(){b=!!(window.history&&history.pushState&&history.replaceState);b=false}d();this.setPage=function(f,e){this.updateState({page:f},"",e)};this.havePage=function(){return(this.getState()!==false)};this.getPage=function(){var e;if(this.havePage()){e=this.getState();return e.page}return 1};this.getState=function(){var g,e,f;if(b){e=history.state;if(e&&e.ias){return e.ias}}else{g=(window.location.hash.substring(0,7)==="#/page/");if(g){f=parseInt(window.location.hash.replace("#/page/",""),10);return{page:f}}}return false};this.updateState=function(f,g,e){if(c){this.replaceState(f,g,e)}else{this.pushState(f,g,e)}};this.pushState=function(f,h,e){var g;if(b){history.pushState({ias:f},h,e)}else{g=(f.page>0?"#/page/"+f.page:"");window.location.hash=g}c=true};this.replaceState=function(f,g,e){if(b){history.replaceState({ias:f},g,e)}else{this.pushState(f,g,e)}}}})(jQuery);
